---
layout: post
title:  "如何在OSX El Capitan下使用基于CH34x芯片的USB串口适配线"
date:   2015-12-10 07:47:23
categories: programming
---
淘宝上有很多廉价的USB转串口的适配线，这其中不少使用的是南京的沁恒公司的CH34x芯片。

我们可以在“关于本机”-“系统报告”-“硬件”-“USB”里查看适配线的VID（厂商ID），来确定适配线是否基于CH34x芯片。CH34x的VID是0x1a86，我这根的PID（产品ID）是0x7523，你的PID可能不同，0x5523也是一个可用的PID。

确定芯片后，就可以去找驱动程序了。沁恒的网址是<http://www.wch.cn>，我们可以从上面找到我们需要的驱动。[Mac的驱动也是有的](http://www.wch.cn/download/CH341SER_MAC_ZIP.html)，不过太老了，未经签名，所以通过不了苹果在OSX 10.11上加入的SIP[^1]保护技术。如果直接安装这个驱动，肯定是用不了的。必须屏蔽SIP对kext[^2]的保护。

设置SIP，我们需要用到csrutil，它就是SIP的配置修改工具。使用csrutil，必须进入恢复模式。恢复模式的进入方法是：开机（重启）时，同时按CMD键和R键。进入恢复模式之后，在“实用工具”里找到“终端”，在终端里输入：

```
csrutil enable --without kext
```

然后重启。这时再去安装从沁恒公司网站下载的那个Mac驱动。安装完成后，再次重启，进入系统之后就能在***/dev***下面找到***tty.wchusbserial14130***了。注意，因为我的PID是0x7523，所以tty.wchusbserial后面的数字是14130（即0x7523的十进制数）。你也可能看到别的类似的设备文件名。

这样操作之后，就能正常使用CH34x适配线了。但是也丧失了SIP对系统的某些保护，降低了系统的安全性。如果手头宽裕，还是建议购买贵一些的，持续支持Mac系统的适配线。购买之前，先搞清楚要买的线能不能很方便的在最新的Mac上使用。不要像我，买的时候没花时间直接下单，到货了折腾半天才用起来。

[^1]: System Integrity Protection
[^2]: OSX的内核扩展，驱动一般是以这种形式存在的
